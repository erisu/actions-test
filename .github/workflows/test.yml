name: Action CI Test

on:
  push:
    branches: [ main ]

jobs:
  build:
    name: iOS ${{ matrix.versions.ios-range }} Test
    runs-on: macos-latest
    
    strategy:
      matrix:
        versions:
          - ios-config: 12.x
            ios-version: 12.4
            xcode-version: 10.3
            
          - ios-config: 13.x
            ios-version: 13.7
            xcode-version: 11.7
            
          - ios-config: 14.x
            ios-version: 14.4
            xcode-version: 12.4

    steps:
      - uses: actions/checkout@v2

      - name: Run get uname
        run: uname -a

      - name: Run get xcode list
        run: ls -n /Applications/ | grep Xcode

      - name: Run prepare iOS simulator
      
        run: |
          sudo mkdir -p /Library/Developer/CoreSimulator/Profiles/Runtimes
          sudo ln -s /Applications/Xcode_${{ matrix.versions.xcode-version }}.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime /Library/Developer/CoreSimulator/Profiles/Runtimes/iOS\ ${{ matrix.versions.ios-version }}.simruntime
# xcrun simctl list runtimes
# xcrun simctl create custom-test-device "iPad Pro (9.7-inch)" "com.apple.CoreSimulator.SimRuntime.iOS-12-4"
# xcrun simctl list devices 12.4

      - name: Run get simulation list
        run: xcrun xctrace list devices 2>&1 | grep \'^iPhone\
